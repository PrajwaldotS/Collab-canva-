<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SketchTogether - Enhanced Collaborative Drawing</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .canvas-container {
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .drawing-canvas {
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            cursor: crosshair;
            touch-action: none;
        }

        .toolbar {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .tool-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .tool-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-picker:hover {
            transform: scale(1.1);
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #667eea, #764ba2);
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .chat-panel {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .message {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-cursor {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
            transition: all 0.1s ease-out;
        }

        .presence-indicator {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-wrap: wrap;
                padding: 0.75rem;
            }
            
            .tool-btn {
                min-width: 44px;
                min-height: 44px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Firebase Configuration (Demo - replace with your config)
        const firebaseConfig = {
            apiKey: "demo-api-key",
            authDomain: "demo.firebaseapp.com",
            databaseURL: "https://demo-default-rtdb.firebaseio.com/",
            projectId: "demo-project",
            storageBucket: "demo.appspot.com",
            messagingSenderId: "123456789",
            appId: "demo-app-id"
        };

        // Mock Firebase for demo
        const mockFirebase = {
            database: {
                ref: (path) => ({
                    push: (data) => Promise.resolve({ key: Date.now().toString() }),
                    set: (data) => Promise.resolve(),
                    on: (event, callback) => {},
                    off: () => {},
                    once: (event) => Promise.resolve({ val: () => null })
                })
            }
        };

        // Drawing Tools Component
        function DrawingToolbar({ 
            selectedTool, 
            setSelectedTool, 
            color, 
            setColor, 
            thickness, 
            setThickness,
            onUndo,
            onRedo,
            onClear,
            onExport
        }) {
            const tools = [
                { id: 'pencil', icon: 'fas fa-pencil-alt', name: 'Pencil' },
                { id: 'line', icon: 'fas fa-minus', name: 'Line' },
                { id: 'rectangle', icon: 'far fa-square', name: 'Rectangle' },
                { id: 'circle', icon: 'far fa-circle', name: 'Circle' },
                { id: 'triangle', icon: 'fas fa-play', name: 'Triangle' },
                { id: 'eraser', icon: 'fas fa-eraser', name: 'Eraser' },
                { id: 'text', icon: 'fas fa-font', name: 'Text' }
            ];

            const presetColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'];

            return (
                <div className="toolbar fixed top-4 left-4 p-4 rounded-2xl z-50 flex flex-wrap gap-3 max-w-xs">
                    {/* Tool Buttons */}
                    <div className="flex flex-wrap gap-2">
                        {tools.map(tool => (
                            <button
                                key={tool.id}
                                className={`tool-btn p-3 border-0 ${selectedTool === tool.id ? 'active' : 'bg-white hover:bg-gray-50'}`}
                                onClick={() => setSelectedTool(tool.id)}
                                title={tool.name}
                            >
                                <i className={tool.icon}></i>
                            </button>
                        ))}
                    </div>

                    {/* Color Picker */}
                    <div className="flex flex-wrap gap-2 w-full">
                        <input
                            type="color"
                            value={color}
                            onChange={(e) => setColor(e.target.value)}
                            className="color-picker"
                            title="Custom Color"
                        />
                        {presetColors.map(presetColor => (
                            <button
                                key={presetColor}
                                className="w-8 h-8 rounded-full border-2 border-white shadow-md hover:scale-110 transition-transform"
                                style={{ backgroundColor: presetColor }}
                                onClick={() => setColor(presetColor)}
                                title={presetColor}
                            />
                        ))}
                    </div>

                    {/* Thickness Slider */}
                    <div className="w-full">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                            Size: {thickness}px
                        </label>
                        <input
                            type="range"
                            min="1"
                            max="50"
                            value={thickness}
                            onChange={(e) => setThickness(parseInt(e.target.value))}
                            className="slider w-full"
                        />
                    </div>

                    {/* Action Buttons */}
                    <div className="flex gap-2 w-full">
                        <button
                            onClick={onUndo}
                            className="tool-btn flex-1 p-2 bg-blue-500 text-white hover:bg-blue-600"
                            title="Undo"
                        >
                            <i className="fas fa-undo"></i>
                        </button>
                        <button
                            onClick={onRedo}
                            className="tool-btn flex-1 p-2 bg-blue-500 text-white hover:bg-blue-600"
                            title="Redo"
                        >
                            <i className="fas fa-redo"></i>
                        </button>
                        <button
                            onClick={onClear}
                            className="tool-btn flex-1 p-2 bg-red-500 text-white hover:bg-red-600"
                            title="Clear"
                        >
                            <i className="fas fa-trash"></i>
                        </button>
                        <button
                            onClick={onExport}
                            className="tool-btn flex-1 p-2 bg-green-500 text-white hover:bg-green-600"
                            title="Export"
                        >
                            <i className="fas fa-download"></i>
                        </button>
                    </div>
                </div>
            );
        }

        // Drawing Canvas Component
        function DrawingCanvas({ selectedTool, color, thickness, onDrawingUpdate }) {
            const canvasRef = useRef(null);
            const contextRef = useRef(null);
            const isDrawing = useRef(false);
            const startPoint = useRef({ x: 0, y: 0 });
            const tempCanvas = useRef(null);
            const undoStack = useRef([]);
            const redoStack = useRef([]);

            const setupCanvas = useCallback(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const container = canvas.parentElement;
                const rect = container.getBoundingClientRect();
                
                // Set display size
                const displayWidth = rect.width - 32; // Account for padding
                const displayHeight = window.innerHeight - 100;
                
                canvas.style.width = displayWidth + 'px';
                canvas.style.height = displayHeight + 'px';
                
                // Set actual size in memory (scaled up for crisp rendering)
                const scale = window.devicePixelRatio || 1;
                canvas.width = displayWidth * scale;
                canvas.height = displayHeight * scale;
                
                // Scale the drawing context back down
                const ctx = canvas.getContext('2d');
                ctx.scale(scale, scale);
                
                // Set context properties for smooth drawing
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                contextRef.current = ctx;
                
                // Create temp canvas for shape preview
                if (!tempCanvas.current) {
                    tempCanvas.current = document.createElement('canvas');
                    tempCanvas.current.width = canvas.width;
                    tempCanvas.current.height = canvas.height;
                }
                
                // Save initial state for undo
                saveCanvasState();
            }, []);

            useEffect(() => {
                setupCanvas();
                window.addEventListener('resize', setupCanvas);
                return () => window.removeEventListener('resize', setupCanvas);
            }, [setupCanvas]);

            const getMousePos = useCallback((e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                return {
                    x: (e.clientX - rect.left) * scaleX / (window.devicePixelRatio || 1),
                    y: (e.clientY - rect.top) * scaleY / (window.devicePixelRatio || 1)
                };
            }, []);

            const getTouchPos = useCallback((e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const touch = e.touches[0];
                return {
                    x: (touch.clientX - rect.left) * scaleX / (window.devicePixelRatio || 1),
                    y: (touch.clientY - rect.top) * scaleY / (window.devicePixelRatio || 1)
                };
            }, []);

            const saveCanvasState = useCallback(() => {
                const canvas = canvasRef.current;
                if (canvas) {
                    undoStack.current.push(canvas.toDataURL());
                    if (undoStack.current.length > 50) {
                        undoStack.current.shift();
                    }
                    redoStack.current = [];
                }
            }, []);

            const startDrawing = useCallback((pos) => {
                const ctx = contextRef.current;
                if (!ctx) return;

                isDrawing.current = true;
                startPoint.current = pos;

                ctx.strokeStyle = selectedTool === 'eraser' ? '#FFFFFF' : color;
                ctx.lineWidth = thickness;
                ctx.globalCompositeOperation = selectedTool === 'eraser' ? 'destination-out' : 'source-over';

                if (selectedTool === 'pencil') {
                    ctx.beginPath();
                    ctx.moveTo(pos.x, pos.y);
                } else if (['line', 'rectangle', 'circle', 'triangle'].includes(selectedTool)) {
                    // Save current canvas state for shape preview
                    const tempCtx = tempCanvas.current.getContext('2d');
                    tempCtx.clearRect(0, 0, tempCanvas.current.width, tempCanvas.current.height);
                    tempCtx.drawImage(canvasRef.current, 0, 0);
                }
            }, [selectedTool, color, thickness]);

            const draw = useCallback((pos) => {
                if (!isDrawing.current) return;
                
                const ctx = contextRef.current;
                if (!ctx) return;

                if (selectedTool === 'pencil' || selectedTool === 'eraser') {
                    ctx.lineTo(pos.x, pos.y);
                    ctx.stroke();
                } else if (['line', 'rectangle', 'circle', 'triangle'].includes(selectedTool)) {
                    // Clear canvas and redraw from temp canvas
                    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                    ctx.drawImage(tempCanvas.current, 0, 0);
                    
                    // Draw preview shape
                    ctx.beginPath();
                    const startX = startPoint.current.x;
                    const startY = startPoint.current.y;
                    const endX = pos.x;
                    const endY = pos.y;

                    switch (selectedTool) {
                        case 'line':
                            ctx.moveTo(startX, startY);
                            ctx.lineTo(endX, endY);
                            break;
                        case 'rectangle':
                            ctx.rect(startX, startY, endX - startX, endY - startY);
                            break;
                        case 'circle':
                            const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                            ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                            break;
                        case 'triangle':
                            ctx.moveTo(startX, startY);
                            ctx.lineTo(endX, endY);
                            ctx.lineTo(startX - (endX - startX), endY);
                            ctx.closePath();
                            break;
                    }
                    ctx.stroke();
                }
            }, [selectedTool]);

            const stopDrawing = useCallback(() => {
                if (!isDrawing.current) return;
                
                isDrawing.current = false;
                
                if (selectedTool === 'pencil' || selectedTool === 'eraser' || 
                    ['line', 'rectangle', 'circle', 'triangle'].includes(selectedTool)) {
                    saveCanvasState();
                    onDrawingUpdate?.();
                }
            }, [selectedTool, onDrawingUpdate]);

            // Mouse Events
            const handleMouseDown = useCallback((e) => {
                e.preventDefault();
                const pos = getMousePos(e);
                startDrawing(pos);
            }, [getMousePos, startDrawing]);

            const handleMouseMove = useCallback((e) => {
                e.preventDefault();
                const pos = getMousePos(e);
                draw(pos);
            }, [getMousePos, draw]);

            const handleMouseUp = useCallback((e) => {
                e.preventDefault();
                stopDrawing();
            }, [stopDrawing]);

            // Touch Events
            const handleTouchStart = useCallback((e) => {
                e.preventDefault();
                const pos = getTouchPos(e);
                startDrawing(pos);
            }, [getTouchPos, startDrawing]);

            const handleTouchMove = useCallback((e) => {
                e.preventDefault();
                const pos = getTouchPos(e);
                draw(pos);
            }, [getTouchPos, draw]);

            const handleTouchEnd = useCallback((e) => {
                e.preventDefault();
                stopDrawing();
            }, [stopDrawing]);

            // Undo/Redo Functions
            const undo = useCallback(() => {
                if (undoStack.current.length > 1) {
                    const currentState = undoStack.current.pop();
                    redoStack.current.push(currentState);
                    
                    const previousState = undoStack.current[undoStack.current.length - 1];
                    const img = new Image();
                    img.onload = () => {
                        contextRef.current.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                        contextRef.current.drawImage(img, 0, 0);
                    };
                    img.src = previousState;
                }
            }, []);

            const redo = useCallback(() => {
                if (redoStack.current.length > 0) {
                    const nextState = redoStack.current.pop();
                    undoStack.current.push(nextState);
                    
                    const img = new Image();
                    img.onload = () => {
                        contextRef.current.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                        contextRef.current.drawImage(img, 0, 0);
                    };
                    img.src = nextState;
                }
            }, []);

            const clearCanvas = useCallback(() => {
                const ctx = contextRef.current;
                if (ctx) {
                    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                    saveCanvasState();
                }
            }, [saveCanvasState]);

            const exportCanvas = useCallback(() => {
                const canvas = canvasRef.current;
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = `sketch-${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                }
            }, []);

            return {
                canvasRef,
                handleMouseDown,
                handleMouseMove,
                handleMouseUp,
                handleTouchStart,
                handleTouchMove,
                handleTouchEnd,
                undo,
                redo,
                clearCanvas,
                exportCanvas
            };
        }

        // Chat Component
        function ChatPanel({ userName, roomCode }) {
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const sendMessage = useCallback(() => {
                if (newMessage.trim()) {
                    const message = {
                        id: Date.now(),
                        text: newMessage,
                        sender: userName,
                        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                        color: `hsl(${Math.random() * 360}, 70%, 50%)`
                    };
                    
                    setMessages(prev => [...prev, message]);
                    setNewMessage('');
                    
                    // In real app, send to Firebase
                    // mockFirebase.database.ref(`rooms/${roomCode}/messages`).push(message);
                }
            }, [newMessage, userName, roomCode]);

            const handleKeyPress = useCallback((e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            }, [sendMessage]);

            return (
                <div className="chat-panel fixed right-4 top-4 w-80 h-96 rounded-2xl p-4 flex flex-col shadow-2xl">
                    <h3 className="text-lg font-bold mb-3 text-gray-800">
                        <i className="fas fa-comments mr-2 text-blue-500"></i>
                        Chat Room
                    </h3>
                    
                    <div className="flex-1 overflow-y-auto space-y-2 mb-4">
                        {messages.map(message => (
                            <div key={message.id} className="message">
                                <div className="flex items-start space-x-2">
                                    <div 
                                        className="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold"
                                        style={{ backgroundColor: message.color }}
                                    >
                                        {message.sender.charAt(0).toUpperCase()}
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex items-center space-x-2">
                                            <span className="font-medium text-sm text-gray-700">{message.sender}</span>
                                            <span className="text-xs text-gray-400">{message.timestamp}</span>
                                        </div>
                                        <p className="text-sm text-gray-800 mt-1">{message.text}</p>
                                    </div>
                                </div>
                            </div>
                        ))}
                        <div ref={messagesEndRef} />
                    </div>
                    
                    <div className="flex space-x-2">
                        <input
                            type="text"
                            value={newMessage}
                            onChange={(e) => setNewMessage(e.target.value)}
                            onKeyPress={handleKeyPress}
                            placeholder="Type a message..."
                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button
                            onClick={sendMessage}
                            className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                        >
                            <i className="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            );
        }

        // User Presence Component
        function UserPresence({ users }) {
            return (
                <div className="fixed top-4 right-96 bg-white bg-opacity-95 backdrop-blur-sm rounded-xl p-3 shadow-lg">
                    <h4 className="text-sm font-semibold text-gray-700 mb-2">
                        <i className="fas fa-users mr-1"></i>
                        Online ({users.length})
                    </h4>
                    <div className="flex space-x-2">
                        {users.map(user => (
                            <div key={user.id} className="text-center">
                                <div 
                                    className="presence-indicator w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold"
                                    style={{ backgroundColor: user.color }}
                                    title={user.name}
                                >
                                    {user.name.charAt(0).toUpperCase()}
                                </div>
                                <span className="text-xs text-gray-600 block mt-1 truncate w-8">{user.name}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Main App Component
        function SketchTogetherApp() {
            const [selectedTool, setSelectedTool] = useState('pencil');
            const [color, setColor] = useState('#FF6B6B');
            const [thickness, setThickness] = useState(3);
            const [userName, setUserName] = useState('');
            const [roomCode, setRoomCode] = useState('');
            const [isInRoom, setIsInRoom] = useState(false);
            const [users, setUsers] = useState([]);

            const canvasHandlers = DrawingCanvas({ 
                selectedTool, 
                color, 
                thickness, 
                onDrawingUpdate: () => {
                    // In real app, sync drawing data to Firebase
                    console.log('Drawing updated');
                }
            });

            useEffect(() => {
                // Mock user data for demo
                if (isInRoom && userName) {
                    const mockUsers = [
                        { id: '1', name: userName, color: '#FF6B6B' },
                        { id: '2', name: 'Alice', color: '#4ECDC4' },
                        { id: '3', name: 'Bob', color: '#45B7D1' }
                    ];
                    setUsers(mockUsers);
                }
            }, [isInRoom, userName]);

            const joinRoom = useCallback(() => {
                if (userName.trim() && roomCode.trim()) {
                    setIsInRoom(true);
                    // In real app, join Firebase room
                }
            }, [userName, roomCode]);

            const createRoom = useCallback(() => {
                if (userName.trim()) {
                    const newRoomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                    setRoomCode(newRoomCode);
                    setIsInRoom(true);
                    // In real app, create Firebase room
                }
            }, [userName]);

            if (!isInRoom) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="bg-white bg-opacity-95 backdrop-blur-sm rounded-2xl p-8 shadow-2xl max-w-md w-full">
                            <div className="text-center mb-6">
                                <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                                    SketchTogether
                                </h1>
                                <p className="text-gray-600 mt-2">Collaborative Drawing Made Easy</p>
                            </div>
                            
                            <div className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Enter your name"
                                    value={userName}
                                    onChange={(e) => setUserName(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                
                                <input
                                    type="text"
                                    placeholder="Room code (optional)"
                                    value={roomCode}
                                    onChange={(e) => setRoomCode(e.target.value.toUpperCase())}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                
                                <div className="flex space-x-3">
                                    <button
                                        onClick={joinRoom}
                                        disabled={!userName.trim() || !roomCode.trim()}
                                        className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                    >
                                        Join Room
                                    </button>
                                    
                                    <button
                                        onClick={createRoom}
                                        disabled={!userName.trim()}
                                        className="flex-1 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                    >
                                        Create Room
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4">
                    {/* Room Info */}
                    <div className="fixed bottom-4 left-4 bg-white bg-opacity-95 backdrop-blur-sm rounded-xl p-3 shadow-lg">
                        <p className="text-sm font-medium text-gray-700">
                            Room: <span className="font-mono font-bold text-blue-600">{roomCode}</span>
                        </p>
                        <p className="text-xs text-gray-500">Share this code to invite others</p>
                    </div>

                    {/* Toolbar */}
                    <DrawingToolbar
                        selectedTool={selectedTool}
                        setSelectedTool={setSelectedTool}
                        color={color}
                        setColor={setColor}
                        thickness={thickness}
                        setThickness={setThickness}
                        onUndo={canvasHandlers.undo}
                        onRedo={canvasHandlers.redo}
                        onClear={canvasHandlers.clearCanvas}
                        onExport={canvasHandlers.exportCanvas}
                    />

                    {/* User Presence */}
                    <UserPresence users={users} />

                    {/* Chat Panel */}
                    <ChatPanel userName={userName} roomCode={roomCode} />

                    {/* Canvas */}
                    <div className="canvas-container flex justify-center items-center min-h-screen pt-4">
                        <canvas
                            ref={canvasHandlers.canvasRef}
                            className="drawing-canvas bg-white"
                            onMouseDown={canvasHandlers.handleMouseDown}
                            onMouseMove={canvasHandlers.handleMouseMove}
                            onMouseUp={canvasHandlers.handleMouseUp}
                            onMouseLeave={canvasHandlers.handleMouseUp}
                            onTouchStart={canvasHandlers.handleTouchStart}
                            onTouchMove={canvasHandlers.handleTouchMove}
                            onTouchEnd={canvasHandlers.handleTouchEnd}
                        />
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<SketchTogetherApp />, document.getElementById('root'));
    </script>
</body>
</html>